## ----setup, include=FALSE---------------------------------------------------------------------------------------------------------------------
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(lubridate)
library(tidyverse)
library(ggplot2)
library(readr)
library(readxl)
library(usdata)
library(tm)
library(stringr)
library(gbm)
library(glmnetUtils) # boosting


## ---------------------------------------------------------------------------------------------------------------------------------------------
# install.packages("scales")              # dependency of plot_glmnet
source("functions/plot_glmnet.R")


## ---------------------------------------------------------------------------------------------------------------------------------------------
theft_train = read.csv('../data/clean/theft_train.csv')


## ---------------------------------------------------------------------------------------------------------------------------------------------
elnet_fit = cva.glmnet(theftrate ~ . -fips -county -state, # formula notation, as usual
                       nfolds = 10,               # number of folds
                       data = theft_train)   # data to run on


## ---------------------------------------------------------------------------------------------------------------------------------------------
elnet_fit$alpha


## ---------------------------------------------------------------------------------------------------------------------------------------------
plot_cva_glmnet(elnet_fit)


## ---------------------------------------------------------------------------------------------------------------------------------------------
elnet_fit_best = extract_best_elnet(elnet_fit)


## ---------------------------------------------------------------------------------------------------------------------------------------------
elnet_fit_best$alpha


## ---------------------------------------------------------------------------------------------------------------------------------------------
plot(elnet_fit_best)


## ---------------------------------------------------------------------------------------------------------------------------------------------
plot_glmnet(elnet_fit_best, theft_train)


## ---------------------------------------------------------------------------------------------------------------------------------------------
plot_glmnet(elnet_fit_best, theft_train, features_to_plot = 10)


## ----lasso-nonzero-std-coefficients-table-----------------------------------------------------------------------------------------------------
extract_std_coefs(elnet_fit_best, theft_train) %>% 
  filter(coefficient != 0) %>% arrange(desc(abs(coefficient)))

